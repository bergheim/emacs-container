FROM alpine:3.21

# Skip Playwright's bundled glibc browser
ENV PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD=1

# Install Node.js and system Chromium
RUN apk add --no-cache \
    nodejs \
    npm \
    chromium \
    # Chromium dependencies for headless operation
    nss \
    freetype \
    harfbuzz \
    ca-certificates \
    ttf-freefont

# Set Chromium path for Playwright
ENV PLAYWRIGHT_CHROMIUM_EXECUTABLE_PATH=/usr/bin/chromium-browser

# Create non-root user
RUN adduser -D -u 1000 tester
USER tester
WORKDIR /home/tester

# Install Playwright (skip browser download)
RUN npm init -y && npm install playwright

# Copy test script
COPY --chown=tester:tester test.js .

CMD ["node", "test.js"]
